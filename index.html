<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dicatex Aviamentos</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        display: flex; /* Ativa flexbox */
        flex-direction: column; /* Coloca os itens em uma coluna */
        align-items: flex-start; /* Alinha os itens à esquerda */
    }

    #container {
        width: 21cm;
        margin: 0 auto;
        padding: 1cm;
        background-color: #ffffff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
        margin-top: 0;
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }

    #processar {
        display: block;
        margin-bottom: 20px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
    }

    #processar:hover {
        background-color: #45a049;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        display: none; /* Inicialmente ocultar a tabela */
    }

    th, td {
        border: 1px solid #dddddd;
        padding: 8px;
        font-size: 14px; /* Definindo o tamanho da fonte para as células */
    }

    th {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    /* Estil/* Estilo para o contêiner pai dos checkboxes */
/* Estilo para o contêiner pai dos checkboxes */
 /* Estilo para o contêiner pai dos checkboxes */
#familias {
    display: flex; /* Ativa flexbox */
    flex-wrap: wrap; /* Permite que os itens quebrem para a próxima linha */
    align-items: flex-start; /* Alinha os itens verticalmente no topo */
    justify-content: space-between; /* Distribui os itens igualmente nas colunas */
    width: 100%; /* Largura de 90% para evitar que os itens se espalhem por toda a largura da página */
    font-size: 14px;
}

/* Estilo para cada rótulo e checkbox */
#familias label {
    margin-bottom: 10px; /* Adiciona espaço entre os checkboxes */
    width: calc(30% - 10px); /* Calcula a largura para cada coluna, considerando a margem entre as colunas */
    display: flex; /* Ativa flexbox */
    align-items: center; /* Alinha os itens verticalmente */
}

#familias label input[type="checkbox"] {
    margin-right: 5px; /* Adiciona espaço entre o checkbox e o texto */
}

/* Estilo para destacar o texto */
#familias label span {
    font-weight: bold; /* Torna o texto em negrito */
    color: #333; /* Define a cor do texto */
}



</style>
</head>
<body>

    <div id="container">
        <h1>Tabela de Preços Dicatex</h1>
    
        <button id="processar">Processar</button>
    
        <div id="familias"></div> <!-- Adicionando um novo div para exibir as famílias/subfamílias -->
    
        <table id="resultado">
            <thead>
                <tr>
                    <th>Categoria</th>
                    <th>Produto</th>
                    <th>Padrão</th>
                    <th>Distribuidor</th> <!-- Nova coluna -->
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    

<script>
document.getElementById("processar").addEventListener("click", function() {
    // Fazendo a leitura dos arquivos CSV
    fetch('tabpadrao.csv')
        .then(response => response.text())
        .then(tabpadraoData => {
            fetch('bddic.csv')
                .then(response => response.text())
                .then(bddicData => {
                    fetch('tabdist.csv') // Obtendo o terceiro arquivo
                        .then(response => response.text())
                        .then(tabdistData => {
                            processarResultado(tabpadraoData, bddicData, tabdistData); // Passando todos os dados para processar
                        });
                });
        });
});


function processarResultado(tabpadraoData, bddicData, tabdistData) {
    const tableBody = document.querySelector('#resultado tbody');
    tableBody.innerHTML = ''; // Limpar tabela anterior, se houver

    const tabpadraoLinhas = tabpadraoData.split('\n').slice(1);
    const bddicLinhas = bddicData.split('\n').slice(1);
    const tabdistLinhas = tabdistData.split('\n').slice(1); // Separando linhas do novo arquivo

    const ignorarPalavras = [
        "2ª", "SEGUNDA", "2º", "KIT", "*", 
        "BONES", "CONE", "BORRACHA", "BEHA", "CARNEIRA", 
        "CORANTE", "FLAVINA", "ESTAMPA", "100%", "INDUSTRIALIZACAO", 
        "REBOBINAR", "COSTURA", "TRICHE", "ALVEJADO", "CORES"
    ];

    const familiasSubfamilias = {};

    tabpadraoLinhas.forEach(tabpadraoLinha => {
        const tabpadraoCols = tabpadraoLinha.split(';');
        const nomeProdutoTabpadrao = tabpadraoCols[2];
        const descricaoProdutoTabpadrao = tabpadraoCols[2];
        const precoVenda = parseFloat(tabpadraoCols[3].replace(',', '.'));

        // Verifica se o preço de venda é um número válido
        if (!isNaN(precoVenda)) {
            const precoVendaFormatado = precoVenda.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); // Formatando preço padrão

            // Verifica se a descrição do produto contém alguma palavra a ser ignorada
            if (!ignorarPalavras.some(palavra => descricaoProdutoTabpadrao.includes(palavra))) {
                const produtoBddic = bddicLinhas.find(bddicLinha => {
                    const bddicCols = bddicLinha.split(';');
                    const nomeProdutoBddic = bddicCols[4];
                    return nomeProdutoBddic === nomeProdutoTabpadrao;
                });

                if (produtoBddic) {
                    const bddicCols = produtoBddic.split(';');
                    const familiaSubfamilia = `${bddicCols[0]} - ${bddicCols[1]}`;
                    const familia = bddicCols[0];
                    const subfamilia = bddicCols[1];

                    // Obtendo o preço do distribuidor
                    const produtoTabdist = tabdistLinhas.find(tabdistLinha => {
                        const tabdistCols = tabdistLinha.split(';');
                        const nomeProdutoTabdist = tabdistCols[2];
                        return nomeProdutoTabdist === nomeProdutoTabpadrao;
                    });

                    if (produtoTabdist) {
                        const tabdistCols = produtoTabdist.split(';');
                        const precoDistribuidor = parseFloat(tabdistCols[3].replace(',', '.'));

                        // Verifica se o preço do distribuidor é um número válido
                        if (!isNaN(precoDistribuidor)) {
                            const precoDistribuidorFormatado = precoDistribuidor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); // Formatando preço de distribuidor

                            let existingRow = tableBody.querySelector(`tr[data-subfamilia="${familia}-${subfamilia}"]`);
                            if (!existingRow) {
                                existingRow = document.createElement('tr');
                                existingRow.setAttribute('data-subfamilia', `${familia}-${subfamilia}`);
                                existingRow.innerHTML = `<td>${familiaSubfamilia}</td><td>${nomeProdutoTabpadrao}</td><td>${precoVendaFormatado}</td><td>${precoDistribuidorFormatado}</td>`;
                                tableBody.appendChild(existingRow);

                                familiasSubfamilias[`${familia}-${subfamilia}`] = [{ precoVenda: precoVendaFormatado, precoDistribuidor: precoDistribuidorFormatado, nomeProdutoTabpadrao }];
                            } else {
                                const existingProducts = familiasSubfamilias[`${familia}-${subfamilia}`];
                                const hasPrice = existingProducts.some(product => product.precoVenda === precoVendaFormatado);
                                if (!hasPrice) {
                                    existingProducts.push({ precoVenda: precoVendaFormatado, precoDistribuidor: precoDistribuidorFormatado, nomeProdutoTabpadrao });
                                    const productNames = existingProducts.map(product => product.nomeProdutoTabpadrao).join('<br>');
                                    const priceCell = existingRow.querySelector('td:nth-child(3)');
                                    priceCell.innerHTML += `<br>${precoVendaFormatado}`;
                                    const distributorPriceCell = existingRow.querySelector('td:nth-child(4)');
                                    distributorPriceCell.innerHTML += `<br>${precoDistribuidorFormatado}`;
                                    const productCell = existingRow.querySelector('td:nth-child(2)');
                                    productCell.innerHTML = productNames;
                                }
                            }

                            // Exibir a tabela após o processamento dos resultados
                            document.querySelector('table').style.display = 'table';

                            const familiaSubfamiliaDiv = document.getElementById('familias');

                            // Verifica se o checkbox "Marcar todos" já foi adicionado
                            if (!document.getElementById('marcarTodos')) {
                                // Adiciona o checkbox "Marcar todos" apenas se ainda não estiver presente
                                familiaSubfamiliaDiv.innerHTML = `<label><input type="checkbox" id="marcarTodos"> MARCAR TODOS</label>` + familiaSubfamiliaDiv.innerHTML;
                            }

                            if (!familiaSubfamiliaDiv.innerHTML.includes(familiaSubfamilia)) {
                                familiaSubfamiliaDiv.innerHTML += `<label><input type="checkbox" name="familiaSubfamilia" value="${familiaSubfamilia}"><span>${familiaSubfamilia}</span></label>`;
                            }

                            // Adicione este código após a adição do checkbox "Marcar todos"
                            const marcarTodosCheckbox = document.getElementById('marcarTodos');
                            marcarTodosCheckbox.addEventListener('change', function () {
                                const checkboxes = document.querySelectorAll('input[name="familiaSubfamilia"]');
                                checkboxes.forEach(checkbox => {
                                    checkbox.checked = this.checked;
                                });
                            });
                        }
                    }
                }
            }
        }
    });
}

// Função para lidar com a seleção/desmarcação dos checkboxes
function handleCheckboxChange() {
    const checkboxes = document.querySelectorAll('input[name="familiaSubfamilia"]');
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const selectedValue = this.value;
            const tableRows = document.querySelectorAll('#resultado tbody tr');
            tableRows.forEach(row => {
                if (row.getAttribute('data-subfamilia') === selectedValue) {
                    row.style.display = this.checked ? 'table-row' : 'none';
                }
            });
        });
    });
}

// Chamar a função para lidar com a seleção/desmarcação dos checkboxes
handleCheckboxChange();


</script>

</body>
</html>